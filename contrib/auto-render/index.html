<!DOCTYPE html>
<!--To run this example from a clone of the repository, run `make serve`
    in the root KaTeX directory and then visit with your web browser:
    http://0.0.0.0:7936/contrib/auto-render/index.html
  -->
<html>

<head>
  <meta charset="UTF-8">
  <title>Auto-render test</title>
  <script src="/katex.js" type="text/javascript"></script>
  <link href="/katex.css" rel="stylesheet" type="text/css">
  <script src="./auto-render.js" type="text/javascript"></script>
  <style type="text/css">
    body {
      margin: 0px;
      padding: 0px;
      font-size: 36px;
    }

    #test>.blue {
      color: blue;
    }
  </style>
</head>

<body>
  <h1>Broken</h1> 
  <div id="test">
    $$\begin{lgathered}\\f'(x)= \dfrac{1}{ \sqrt{ \frac{1+x^2}{1-x^2} } } \cdot \dfrac{1}{2 \sqrt{ \frac{1+x^2}{1-x^2} } } \cdot \dfrac{2x(1-x^2)-(-2x)(1+x^2)}{(1-x^2)^2} \\ \\ \\ \dfrac{1}{ 2\cdot \frac{1+x^2}{1-x^2} } } \cdot \dfrac{2x(1-x^2+1+x^2)}{(1-x^2)^2} = \dfrac{2x\cdot2(1-x^2)}{2(1+x^2)(1-x^2)^2} = \\ \\ \\ \dfrac{2x}{(1+x^2)(1-x^2)}\end{lgathered}$$
  </div>
  <h1>Fixed</h1> 
  <div id="test2">
    $$\begin{lgathered}\\f'(x)= \dfrac{1}{ \sqrt{ \frac{1+x^2}{1-x^2} } } \cdot \dfrac{1}{2 \sqrt{ \frac{1+x^2}{1-x^2} } } \cdot \dfrac{2x(1-x^2)-(-2x)(1+x^2)}{(1-x^2)^2} \\ \\ \\ \dfrac{1}{ 2\cdot \frac{1+x^2}{1-x^2} } \cdot \dfrac{2x(1-x^2+1+x^2)}{(1-x^2)^2} = \dfrac{2x\cdot2(1-x^2)}{2(1+x^2)(1-x^2)^2} = \\ \\ \\ \dfrac{2x}{(1+x^2)(1-x^2)}\end{lgathered}$$
  </div>
  <script>
      renderMathInElement(
        document.body,
        {
          delimiters: [
            { left: "$$", right: "$$", display: true },
            { left: "$", right: "$", display: false }
          ],
          fallback: false,
        }
      );
  </script>
</body>

</html>